# Learnify - Техническая документация

Курсовая работа по программированию — полнофункциональное веб-приложение для обучения с двухконтурной системой (курсы + тренировки).

## Архитектура проекта

Проект построен по принципу разделения на слои с четким разделением ответственности. Frontend представляет собой Vue 3 SPA приложение с компонентами, stores для управления состоянием, views для страниц, services для работы с API и утилитами для отказоустойчивости. Backend организован как FastAPI REST API с разделением на API роутеры для обработки HTTP запросов, сервисный слой для бизнес-логики, модели для работы с БД, схемы для валидации данных, утилиты и middleware для обработки ошибок.

## Backend (FastAPI + PostgreSQL)

### Технологический стек

Backend построен на FastAPI — современном асинхронном веб-фреймворке для Python. Для работы с базой данных используется SQLAlchemy ORM и PostgreSQL. Миграции БД управляются через Alembic. Валидация данных и сериализация реализованы через Pydantic. Аутентификация построена на JWT токенах. Приложение полностью контейнеризировано через Docker.

### Архитектурные решения

**Модульная структура API** — API организовано по доменам с использованием FastAPI routers. Отдельные модули для аутентификации, категорий, курсов, уроков, пользователей, прогресса, тренировок и достижений.

**Разделение на слои** — четкое разделение ответственности: API слой обрабатывает HTTP запросы и валидирует входные данные, сервисный слой содержит бизнес-логику изолированно от HTTP, модель слой представляет SQLAlchemy модели для работы с БД, схема слой использует Pydantic для валидации и сериализации.

**Dependency Injection** — использование FastAPI Depends для внедрения зависимостей, таких как сессии БД и текущий пользователь. Это обеспечивает чистую архитектуру и тестируемость.

**Глобальная обработка ошибок** — middleware для централизованной обработки исключений. Обрабатываются SQLAlchemy ошибки (операционные и целостности данных), валидационные ошибки с логированием.

**JWT Аутентификация** — реализована система аутентификации с access и refresh токенами. Access token короткоживущий (15 минут), refresh token долгоживущий (7 дней) и хранится в БД. Используется OAuth2 схема для защиты endpoints. Пароли хешируются через bcrypt.

**Алгоритм Spaced Repetition** — реализован алгоритм интервального повторения для адаптивного обучения. Интервалы повторения: 1, 7, 16, 35 дней. Алгоритм адаптируется на основе правильности ответа пользователя. Приоритеты выбора карточек для тренировки: сначала карточки с ошибками, затем карточки, у которых наступило время повторения, и наконец новые карточки.

### API Endpoints

API предоставляет endpoints для аутентификации (регистрация, вход, обновление токена), работы с курсами и обучением (категории, курсы, уроки, запись на курс), отслеживания прогресса (прогресс пользователя, отметка блоков и уроков как выполненных), тренировок (получение карточек по алгоритму spaced repetition, отправка ответов), работы с пользователем и достижениями (данные пользователя, статистика, список и разблокировка достижений).

## Frontend (Vue 3 + TypeScript)

### Технологический стек

Frontend построен на Vue 3 с использованием Composition API. Применяется TypeScript для типобезопасности. Сборка и разработка через Vite. State management реализован через Pinia. Маршрутизация через Vue Router 4. UI компоненты из библиотеки Vuetify 3 (Material Design). Дополнительно используются VueUse для композаблов, date-fns для работы с датами, SCSS для стилизации.

### Архитектурные решения

**Composition API** — использование современного Composition API вместо Options API для лучшей организации кода и переиспользования логики.

**State Management (Pinia)** — централизованное управление состоянием через Pinia stores. Отдельные stores для пользователя (данные, аутентификация), курсов и уроков, карточек для тренировки, достижений.

**Паттерны отказоустойчивости** — реализованы два ключевых паттерна для обеспечения надежности приложения:

- **Circuit Breaker** — паттерн для защиты от каскадных отказов. Три состояния: CLOSED (нормальная работа, запросы проходят), OPEN (разомкнут после превышения порога ошибок), HALF_OPEN (тестирование восстановления после таймаута). Используются разные circuit breakers для разных типов запросов: для read операций (GET) более мягкие пороги, для write операций (POST/PUT/DELETE) более строгие пороги.

- **Retry с Exponential Backoff** — автоматические повторные попытки с экспоненциальной задержкой (1s, 2s, 4s, 8s с максимальной задержкой 10s). Максимум 3 попытки. Повторяются только определенные ошибки: HTTP статусы 408, 429, 500, 502, 503, 504 и сетевые ошибки типа ECONNABORTED, ETIMEDOUT, ENOTFOUND.

**API Service Layer** — централизованный слой для работы с API, который интегрирует Circuit Breaker и Retry паттерны, обрабатывает ошибки и обеспечивает кэширование.

**TypeScript типизация** — строгая типизация всех данных через интерфейсы для курсов, уроков, блоков, пользователей и других сущностей.

**Компонентная архитектура** — модульные переиспользуемые компоненты: базовый компонент карточки, карточка с теорией, различные типы практических карточек (выбор ответа, рефлексивные вопросы, кейсы, текстовый ввод).

**Роутинг** — защищенные маршруты с проверкой аутентификации через navigation guards.

## DevOps

### Docker Compose

Оркестрация всех сервисов через Docker Compose. Три основных сервиса: PostgreSQL для базы данных, Backend на FastAPI, Frontend на Vue 3. Используются health checks для PostgreSQL — backend запускается только после готовности БД. Volumes обеспечивают персистентность данных БД. Nginx используется для production frontend (статическая раздача). Конфигурация через переменные окружения.

## База данных

### Основные таблицы

База данных включает таблицы для пользователей (email, пароль, уровень, XP, стрик), категорий курсов, курсов с метаданными, уроков в курсах, блоков контента (теория/практика), прогресса пользователя по урокам, данных для spaced repetition, достижений, связи пользователей и достижений, refresh токенов для JWT.

### Миграции

Управление схемой БД через Alembic с возможностью создания, применения и отката миграций.

## Ключевые технические достижения

1. **Модульная архитектура** — четкое разделение ответственности между слоями (API, Services, Models, Schemas)
2. **Отказоустойчивость** — Circuit Breaker и Retry паттерны на frontend для защиты от сбоев
3. **Безопасность** — JWT аутентификация с refresh токенами, хеширование паролей через bcrypt
4. **Типобезопасность** — TypeScript на frontend, Pydantic на backend для валидации данных
5. **Контейнеризация** — полная Docker-изация для простого деплоя и разработки
6. **Миграции БД** — версионирование схемы через Alembic для безопасных обновлений

## Команда разработки

- **Виктор Курчиев** — Frontend разработка
- **Алексей Еманов** — Backend разработка
- **Калашников Егор** — Backend разработка
